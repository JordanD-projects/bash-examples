#!/bin/sh

# Define the number of iterations
NUM_ITERATIONS=100000
SOURCE_DIR="~/Desktop/test_eicar"

# Function to test the eicar malware file
stress_eicar_test() {
  echo "Creating directory... \n"
  mkdir -p $SOURCE_DIR

  # Hash for eicar malware
  hash="X5O!P%@AP[4\PZX54(P^)7CC)7}\$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!\$H+H*"
  
  # Decode the base 64 encoded string.
  decodedHash=$(echo "$hash" | base64 --decode)
  
  # Add the contents of the decoded hash to a script we can run.
  echo "$decodedHash" > $SOURCE_DIR/myScript.sh
  
  echo "Creating files... \n"
  seq 1 $NUM_ITERATIONS | parallel --eta echo "Running eicar test file iternation: $NUM_ITERATIONS" ' ; ' sh $SOURCE_DIR/myScript.sh
  
  echo "Waiting for file creation to complete... \n"
  wait
  
  echo "Deleting files... \n"
  rm -rf $SOURCE_DIR

  echo "Done \n"
}

# Call the function
stress_files_create

# clean up script
rm -rf $SOURCE_DIR